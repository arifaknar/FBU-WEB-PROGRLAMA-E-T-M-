--ORNEK 1
BEGIN TRY
	BEGIN TRAN
		UPDATE HESAPLAR SET BAKIYE=(BAKIYE-100)
		WHERE AD='BURAK' AND SOYAD='DÝNÇ'
		
		UPDATE HESAPLAR SET BAKIYE=(BAKIYE+100)
		WHERE AD='YUNUS' AND SOYAD='ÇELÝK'

		DELETE FROM Northwind.dbo.Orders;
		COMMIT TRAN
END TRY
BEGIN CATCH
	PRINT 'HATA : '+ERROR_MESSAGE();
	ROLLBACK;
END CATCH

SELECT * FROM HESAPLAR

--ORNEK 2

BEGIN TRY
	BEGIN TRAN
		DELETE FROM Northwind.dbo.Orders WHERE OrderID=10248
		COMMIT TRAN
END TRY
	
BEGIN CATCH
select ERROR_MESSAGE() as [Hata Mesajý],
ERROR_LINE() as [hata satýr numarasý],
ERROR_STATE() as [hata durumu],
ERROR_NUMBER() as [Hata sql numarasý],
ERROR_SEVERITY() as [hata derecesi]
END CATCH

--ORNEK 3-----------TRANSACTION COUNT----------


BEGIN TRAN
	UPDATE HESAPLAR SET BAKIYE=(BAKIYE-100)
		WHERE AD='BURAK' OR SOYAD='DÝNÇ'
		
		UPDATE HESAPLAR SET BAKIYE=(BAKIYE+100)
		WHERE AD='YUNUS' OR SOYAD='ÇELÝK'
		DELETE FROM Northwind.dbo.Orders
		IF(@@ROWCOUNT=4) --FARKLI BÝR YOL
		BEGIN
			COMMIT TRAN
		END
		ELSE
			BEGIN
				PRINT'hATA : '+ERROR_MESSAGE();
				ROLLBACK;
			END

--ornek 5


DELETE FROM #TEST_TBL
--DROP TABLE TEST_TBL

CREATE TABLE #TEST_TBL(
ISLEM VARCHAR(100)
)
DECLARE @SAYAC INT
SET @SAYAC=0
BEGIN TRAN
	WHILE @SAYAC<=5
	BEGIN
		BEGIN TRANSACTION
		INSERT INTO #TEST_TBL (ISLEM) VALUES ('INSERT 1 KAYIT -> '+CONVERT(varchar(10),@SAYAC))
		SET @SAYAC =@SAYAC+1
		IF @@TRANCOUNT >0 
		BEGIN
			COMMIT TRANSACTION
		END
	END
	SELECT ISLEM FROM #TEST_TBL;
	IF @@TRANCOUNT>0
		BEGIN
		COMMIT TRANSACTION
		END





SELECT * FROM HESAPLAR

--ORNEK 6
--dünkü iþlemi trancate ile yap.


			






























